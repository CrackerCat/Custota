# This intentionally tries to mirror Android.bp as closely as possible

add_library(
    sepol
    STATIC
    selinux/libsepol/src/assertion.c
    selinux/libsepol/src/avrule_block.c
    selinux/libsepol/src/avtab.c
    selinux/libsepol/src/boolean_record.c
    selinux/libsepol/src/booleans.c
    selinux/libsepol/src/conditional.c
    selinux/libsepol/src/constraint.c
    selinux/libsepol/src/context.c
    selinux/libsepol/src/context_record.c
    selinux/libsepol/src/debug.c
    selinux/libsepol/src/ebitmap.c
    selinux/libsepol/src/expand.c
    selinux/libsepol/src/handle.c
    selinux/libsepol/src/hashtab.c
    selinux/libsepol/src/hierarchy.c
    selinux/libsepol/src/iface_record.c
    selinux/libsepol/src/interfaces.c
    selinux/libsepol/src/kernel_to_cil.c
    selinux/libsepol/src/kernel_to_common.c
    selinux/libsepol/src/kernel_to_conf.c
    selinux/libsepol/src/link.c
    selinux/libsepol/src/mls.c
    selinux/libsepol/src/module.c
    selinux/libsepol/src/module_to_cil.c
    selinux/libsepol/src/node_record.c
    selinux/libsepol/src/nodes.c
    selinux/libsepol/src/optimize.c
    selinux/libsepol/src/polcaps.c
    #selinux/libsepol/src/policydb.c
    selinux_hackery/src/policydb_wrapper.c
    selinux/libsepol/src/policydb_convert.c
    selinux/libsepol/src/policydb_public.c
    selinux/libsepol/src/policydb_validate.c
    selinux/libsepol/src/port_record.c
    selinux/libsepol/src/ports.c
    selinux/libsepol/src/services.c
    selinux/libsepol/src/sidtab.c
    selinux/libsepol/src/symtab.c
    selinux/libsepol/src/user_record.c
    selinux/libsepol/src/users.c
    selinux/libsepol/src/util.c
    selinux/libsepol/src/write.c
    selinux/libsepol/cil/src/android.c
    selinux/libsepol/cil/src/cil_binary.c
    selinux/libsepol/cil/src/cil_build_ast.c
    selinux/libsepol/cil/src/cil.c
    selinux/libsepol/cil/src/cil_copy_ast.c
    selinux/libsepol/cil/src/cil_find.c
    selinux/libsepol/cil/src/cil_fqn.c
    selinux/libsepol/cil/src/cil_lexer.l
    selinux/libsepol/cil/src/cil_list.c
    selinux/libsepol/cil/src/cil_log.c
    selinux/libsepol/cil/src/cil_mem.c
    selinux/libsepol/cil/src/cil_parser.c
    selinux/libsepol/cil/src/cil_policy.c
    selinux/libsepol/cil/src/cil_post.c
    selinux/libsepol/cil/src/cil_reset_ast.c
    selinux/libsepol/cil/src/cil_resolve_ast.c
    selinux/libsepol/cil/src/cil_stack.c
    selinux/libsepol/cil/src/cil_strpool.c
    selinux/libsepol/cil/src/cil_symtab.c
    selinux/libsepol/cil/src/cil_tree.c
    selinux/libsepol/cil/src/cil_verify.c
    selinux/libsepol/cil/src/cil_write_ast.c
)

target_include_directories(
    sepol
    PRIVATE
    selinux/libsepol/cil/src
    selinux/libsepol/src
    PUBLIC
    selinux/libsepol/cil/include
    selinux/libsepol/include
    selinux_hackery/include
)

target_compile_definitions(
    sepol
    PRIVATE
    -DHAVE_REALLOCARRAY
)

target_compile_options(
    sepol
    PRIVATE
    -D_GNU_SOURCE
    -Wall
    -Werror
    -W
    -Wundef
    -Wshadow
    -Wno-error=missing-noreturn
    -Wmissing-format-attribute
    # These are needed to cancel out warnings enabled by the Android NDK
    -Wno-assign-enum
    -Wno-cast-align
    -Wno-conditional-uninitialized
    -Wno-implicit-fallthrough
    -Wno-implicit-int-conversion
    -Wno-missing-variable-declarations
    -Wno-shorten-64-to-32
    -Wno-sign-conversion
    -Wno-unreachable-code-break
    -Wno-unreachable-code-return
    -Wno-unused-but-set-variable
    # These reverse global warnings
    -Wno-pedantic
    -Wno-cast-qual
    -Wno-conversion
    $<$<C_COMPILER_ID:GNU>:-Wno-duplicated-branches>
    $<$<C_COMPILER_ID:GNU>:-Wno-format-truncation>
    $<$<C_COMPILER_ID:GNU>:-Wno-jump-misses-init>
    -Wno-missing-declarations
    -Wno-missing-prototypes
)

target_link_libraries(
    sepol
    PRIVATE
    interface.global.CVersion
)
